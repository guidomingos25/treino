<script>
  // ... (todo seu c√≥digo anterior permanece igual at√© o final da fun√ß√£o atualizarTabela)

  function atualizarTabela() {
    const cliente = document.getElementById("filtroCliente").value;
    const dia = document.getElementById("filtroDia").value;
    const textoGeral = document.getElementById("filtroGeral").value.toLowerCase().trim();

    let filtrados = [...dados];

    if (cliente) {
      const idxCliente = cabecalho.findIndex(h => h.toUpperCase() === "CLIENTE");
      if (idxCliente !== -1)
        filtrados = filtrados.filter(l => (l[idxCliente] || "") === cliente);
    }

    if (dia) {
      const idxDiaSemana = cabecalho.findIndex(h => h.toUpperCase().includes("DIA DA SEMANA"));
      if (idxDiaSemana !== -1) {
        filtrados = filtrados.filter(l => {
          const val = (l[idxDiaSemana] || "").toUpperCase().trim();
          if (!val) return false;
          if (/^\d+$/.test(val)) return Number(val) === diaParaNumero[dia];
          if (val.includes(dia)) return true;
          const formas = formasDia[dia] || [];
          return formas.some(f => val.includes(f));
        });
      } else {
        const idxDia = cabecalho.findIndex(h => h.toUpperCase() === dia);
        if (idxDia !== -1) {
          filtrados = filtrados.filter(l => {
            const v = (l[idxDia] || "").toUpperCase().trim();
            return v === "1" || v === "SIM" || v === "X";
          });
        }
      }
    }

    if (textoGeral) {
      filtrados = filtrados.filter(linha =>
        linha.some(cel => cel.toLowerCase().includes(textoGeral))
      );
    }

    const idxOcultar = cabecalho.findIndex(h => h.toUpperCase().includes("DIA DA SEMANA"));
    const corpo = document.getElementById("corpo");

    corpo.innerHTML = filtrados
      .map((linha, i) => {
        const tds = linha
          .map((c, j) => (j === idxOcultar ? null : `<td>${c}</td>`))
          .filter(Boolean)
          .join("");
        
        const input = `<td><input type="text" id="anotacao_${i}"></td>`;

        const tipos = ["Utilit√°rio", "Van", "3/4", "Truck", "Carreta", "Rodotrem"];
        const selectVeiculo = `
          <td>
            <select id="veiculo_${i}">
              <option value=""></option>
              ${tipos.map(v => `<option value="${v}">${v}</option>`).join("")}
            </select>
          </td>`;

        return `<tr>${input}${selectVeiculo}${tds}</tr>`;
      })
      .join("");

    // üé® Pinta as √∫ltimas 14 colunas: 7 cinza, 7 azul
    const linhas = corpo.querySelectorAll("tr");
    linhas.forEach(tr => {
      const tds = tr.querySelectorAll("td");
      const ultimas14 = Array.from(tds).slice(-14);
      const primeiras7 = ultimas14.slice(0, 7);
      const ultimas7 = ultimas14.slice(7);

      primeiras7.forEach(td => {
        if (td.textContent.trim() !== "") td.style.backgroundColor = "#d3d3d3";
      });

      ultimas7.forEach(td => {
        if (td.textContent.trim() !== "") td.style.backgroundColor = "#add8e6";
      });
    });

    // üÜï Adiciona evento de mudan√ßa no select de ve√≠culo
    const selects = corpo.querySelectorAll("select[id^='veiculo_']");
    selects.forEach(sel => {
      sel.addEventListener("change", e => {
        const tr = e.target.closest("tr");
        const tds = tr.querySelectorAll("td");
        const primeiras7 = Array.from(tds).slice(0, 7);

        // Limpa cores anteriores
        primeiras7.forEach(td => td.style.backgroundColor = "");

        // S√≥ pinta se houver ve√≠culo selecionado
        if (e.target.value) {
          primeiras7.forEach(td => td.style.backgroundColor = "#c0ffc0");
        }
      });
    });
  }

  document.getElementById("filtroCliente").addEventListener("change", atualizarTabela);
  document.getElementById("filtroDia").addEventListener("change", atualizarTabela);
  document.getElementById("filtroGeral").addEventListener("input", atualizarTabela);
</script>
