function atualizarTabela() {
  const cliente = document.getElementById("filtroCliente").value;
  const dia = document.getElementById("filtroDia").value;
  let filtrados = [...dados];

  if (cliente) {
    const idxCliente = cabecalho.findIndex(h => h.toUpperCase() === "CLIENTE");
    if (idxCliente !== -1) filtrados = filtrados.filter(l => (l[idxCliente] || "") === cliente);
  }

  if (dia) {
    const idxDiaSemana = cabecalho.findIndex(h => h.toUpperCase().includes("DIA DA SEMANA"));
    if (idxDiaSemana !== -1) {
      filtrados = filtrados.filter(l => {
        const val = (l[idxDiaSemana] || "").toUpperCase().trim();
        if (!val) return false;
        if (/^\d+$/.test(val)) return Number(val) === diaParaNumero[dia];
        if (val.includes(dia)) return true;
        const formas = formasDia[dia] || [];
        return formas.some(f => val.includes(f));
      });
    } else {
      const idxDia = cabecalho.findIndex(h => h.toUpperCase() === dia);
      if (idxDia !== -1) {
        filtrados = filtrados.filter(l => {
          const v = (l[idxDia] || "").toUpperCase().trim();
          return v === "1" || v === "SIM" || v === "X";
        });
      }
    }
  }

  const idxOcultar = cabecalho.findIndex(h => h.toUpperCase().includes("DIA DA SEMANA"));
  const totalCols = cabecalho.length;
  const ultimas14 = Array.from({ length: 14 }, (_, i) => totalCols - 14 + i); // Ã­ndices das Ãºltimas 14 colunas

  document.getElementById("corpo").innerHTML = filtrados
    .map((linha, i) => {
      const tds = linha
        .map((c, j) => {
          if (j === idxOcultar) return null;
          let estilo = "";

          // ðŸ”¹ Se for uma das 14 Ãºltimas colunas e houver texto, pinta a cÃ©lula
          if (ultimas14.includes(j) && c.trim() !== "") {
            estilo = 'style="background-color: #d1f7d6;"'; // verde-claro
          }

          return `<td ${estilo}>${c}</td>`;
        })
        .filter(Boolean)
        .join("");

      const input = `<td><input type="text" id="anotacao_${i}"></td>`;
      return `<tr>${input}${tds}</tr>`;
    })
    .join("");
}
